# DIDWW Voice OTP Gateway - Environment Variables
# Copy this file to .env and fill in your values

# =============================================================================
# REQUIRED - Gateway will not start without these
# =============================================================================

# DIDWW SIP Trunk Configuration (no registration required)
# Anycast: any.out.didww.com | Regional: nyc.us.out.didww.com, fra.eu.out.didww.com, etc.
DIDWW_SIP_HOST=any.out.didww.com       # DIDWW outbound SIP server
DIDWW_USERNAME=your_username           # SIP trunk username from DIDWW portal
DIDWW_PASSWORD=your_password           # SIP trunk password from DIDWW portal

# DEPRECATED - Caller IDs are now managed via Admin UI (Settings > Caller ID Routes)
# These environment variables are ignored. Configure routes in the admin panel instead.
# The system seeds default routes on first startup - update them in Settings.
# DIDWW_CALLER_ID=12125551234          # (DEPRECATED) Use Admin UI instead
# SMS_CALLER_ID=MyBrand                # (DEPRECATED) Use Admin UI instead
# SMS_CALLER_ID_US_CANADA=12125551234  # (DEPRECATED) Use Admin UI instead

# Network Configuration
PUBLIC_IP=203.0.113.10                 # Your server's public IP address (critical for NAT)

# API Security
API_SECRET=your-secret-token-here      # Shared secret for webhook authentication

# =============================================================================
# OPTIONAL - Defaults shown
# =============================================================================

# Voice Message Customization
OTP_MESSAGE_TEMPLATE="Your verification code is {code}. Repeating. {code}."
OTP_VOICE_SPEED=medium                 # slow, medium, fast
OTP_DIGIT_PAUSE_MS=500                 # Pause between digits in milliseconds

# Network Ports
SIP_PORT=5060                          # SIP signaling port (UDP)
RTP_PORT_START=10000                   # RTP media port range start
RTP_PORT_END=10020                     # RTP media port range end (supports ~10 concurrent calls)
HTTP_PORT=8080                         # HTTP API port

# ARI (Asterisk REST Interface) - Internal communication
ARI_PASSWORD=internal-ari-secret       # Password for Node.js to Asterisk communication

# AMI (Asterisk Manager Interface) - SIP failure detection
AMI_ENABLED=true                       # Enable AMI for Q.850 cause code detection
AMI_SECRET=internal-ami-secret         # Password for AMI authentication (auto-configured)

# Logging
LOG_LEVEL=info                         # debug, info, warn, error

# ASN Database (fraud detection)
ASN_ENABLED=true                       # Enable ASN lookups for fraud detection
ASN_DATA_PATH=/data/asn.mmdb           # Path for downloaded ASN database
ASN_UPDATE_INTERVAL_HOURS=168          # Check for updates weekly (default: 168 = 7 days)
ASN_SHADOW_BAN_UNRESOLVED=true         # Shadow-ban IPs with unresolved ASN after update attempt

# =============================================================================
# FIREWALL CONFIGURATION (for scripts/firewall-setup.sh)
# =============================================================================

# DIDWW network addresses for SIP/RTP/SMS callbacks (comma-separated, CIDR notation)
# Source: https://doc.didww.com/voice/inbound-trunks/technical-data/sip.html
# IPv4: 46.19.208.0/21 (voice servers), 185.238.172.0/22 (Amsterdam + registration)
# IPv6: 2a01:ad00::/32 (all DIDWW IPv6 space)
DIDWW_ALLOWED_IPS=46.19.208.0/21,185.238.172.0/22,2a01:ad00::/32

# Your application server IPs allowed to access HTTP API (comma-separated, CIDR notation)
# These IPs can send OTP requests to /dispatch endpoint and access admin panel
#
# OPTIONAL: Leave empty or comment out to allow HTTP from anywhere.
# This is useful when using serverless functions (e.g., Supabase Edge Functions)
# that don't have static IPs. Security relies on API_SECRET and admin credentials.
#
# Examples:
#   ALLOWED_CLIENT_IPS=10.0.0.0/8                    # Single subnet
#   ALLOWED_CLIENT_IPS=1.2.3.4/32,5.6.7.0/24        # Multiple entries
#   ALLOWED_CLIENT_IPS=                              # Empty = open to all (default)
ALLOWED_CLIENT_IPS=
